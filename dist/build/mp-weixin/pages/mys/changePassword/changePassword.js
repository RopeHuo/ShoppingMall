(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/mys/changePassword/changePassword"],{4573:function(t,s,e){"use strict";(function(t){e("6cdc");r(e("66fd"));var s=r(e("f4e9"));function r(t){return t&&t.__esModule?t:{default:t}}t(s.default)}).call(this,e("543d")["createPage"])},"4d4d":function(t,s,e){"use strict";e.r(s);var r=e("a1a2"),n=e.n(r);for(var a in r)"default"!==a&&function(t){e.d(s,t,function(){return r[t]})}(a);s["default"]=n.a},"79bb":function(t,s,e){"use strict";var r=function(){var t=this,s=t.$createElement;t._self._c},n=[];e.d(s,"a",function(){return r}),e.d(s,"b",function(){return n})},a1a2:function(t,s,e){"use strict";(function(t){Object.defineProperty(s,"__esModule",{value:!0}),s.default=void 0;var r=e("2f62");function n(t,s){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);s&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable})),e.push.apply(e,r)}return e}function a(t){for(var s=1;s<arguments.length;s++){var e=null!=arguments[s]?arguments[s]:{};s%2?n(e,!0).forEach(function(s){i(t,s,e[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):n(e).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(e,s))})}return t}function i(t,s,e){return s in t?Object.defineProperty(t,s,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[s]=e,t}var o=(0,r.createNamespacedHelpers)("storeCommodity"),u=o.mapState,c=o.mapMutations,d={data:function(){return a({originalPassword:"",salesman:!1,username:"",isBtn:!1,btnTxt:"获取验证码",password:"",confirmPassword:"",code:""},u(["isLogin"]))},onLoad:function(t){t.phone&&(this.username=t.phone)},onShow:function(){var t=this;this.$request.GET({url:this.$api.apiUrl.GET_USER_INFO}).then(function(s){var e=s.data;"salesman"!==e.rule?t.salesman=!1:t.salesman=!0})},methods:a({},c(["LOGIN"]),{getCode:function(){var s=this,e=/^(((13[0-9]{1})|(14[0-9]{1})|(17[0-9]{1})|(15[0-3]{1})|(15[5-9]{1})|(18[0-9]{1})|(19[0-9]{1}))+\d{8})$/;if(!e.test(this.username))return this.$api.msg("输入正确的手机号"),!1;this.$request.POST({url:this.$api.apiUrl.POST_SMS_GETCODE,data:{phone:this.username}}).then(function(e){200===e.errCode?(t.showToast({title:e.errMsg}),s.codeDisabled()):s.$api.msg(e.errMsg)})},codeDisabled:function(){var t=this;this.isBtn=!0;var s=60,e=setInterval(function(){s>0?t.btnTxt=s--+"秒后":(t.isBtn=!1,t.btnTxt="重新发送",s=60,clearInterval(e))},1e3)},passwordIdentical:function(){var t=/^(?![0-9]+$)(?![a-zA-Z]+$)[0-9A-Za-z]{6,16}$/;return t.test(this.password)?this.password===this.confirmPassword||(this.$api.msg("你输入的密码不相同,请核实"),!1):(this.$api.msg("密码需在6-16位数字和字母的组合"),!1)},submit:function(){var s=this,e=this.passwordIdentical();e&&this.$request.POST({url:this.$api.apiUrl.POST_SMS_CHECK,data:{code:this.code,phone:this.username}}).then(function(e){200===e.errCode?s.$request.POST({url:s.$api.apiUrl.POST_USER_REPASS,data:{phone:s.username,password:s.password,repassword:s.confirmPassword}}).then(function(e){1===e.errCode?t.showToast({title:e.errMsg,success:function(){s.userLogin()}}):s.$api.msg("更改失败,不能与当前使用密码相同")}):s.$api.msg(e.errMsg)})},userLogin:function(){var s=this;this.$request.POST({url:this.$api.apiUrl.POST_USER_LOGIN,data:{username:this.username,password:this.password}}).then(function(e){200===e.code?t.setStorage({key:"access_token",data:e.data,success:function(){Promise.all([s.LOGIN({isLogin:!s.isLogin()})]).then(function(){t.showToast({title:e.msg}),t.switchTab({url:"/pages/mys/user/user"})})},fail:function(){t.showToast({title:"Token设置失败，请自行登录",success:function(){t.switchTab({url:"/pages/mys/login/login"})}})}}):s.$api.msg(e.msg)})},staffSubmit:function(){var s=this;if(!this.originalPassword)return this.$api.msg("请输入原密码"),!1;var e=this.passwordIdentical();e&&this.$request.POST({url:this.$api.apiUrl.POST_V6_PARTNER_CHANGEPASSWORD,data:{oldpassword:this.originalPassword,password:this.password,repassword:this.confirmPassword}}).then(function(e){"SECCUSS"===e.code?t.showToast({title:e.msg,success:function(){t.switchTab({url:"/pages/mys/user/user"})}}):s.$api.msg(e.msg)})}})};s.default=d}).call(this,e("543d")["default"])},d6c9:function(t,s,e){},f2a4:function(t,s,e){"use strict";var r=e("d6c9"),n=e.n(r);n.a},f4e9:function(t,s,e){"use strict";e.r(s);var r=e("79bb"),n=e("4d4d");for(var a in n)"default"!==a&&function(t){e.d(s,t,function(){return n[t]})}(a);e("f2a4");var i=e("2877"),o=Object(i["a"])(n["default"],r["a"],r["b"],!1,null,null,null);s["default"]=o.exports}},[["4573","common/runtime","common/vendor"]]]);