(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/goodss/product/product"],{"059c":function(e,t,i){"use strict";(function(e){i("6cdc");s(i("66fd"));var t=s(i("ef58"));function s(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,i("543d")["createPage"])},1540:function(e,t,i){"use strict";var s=i("8f00"),n=i.n(s);n.a},"8f00":function(e,t,i){},d102:function(e,t,i){"use strict";i.r(t);var s=i("edb1"),n=i.n(s);for(var a in s)"default"!==a&&function(e){i.d(t,e,function(){return s[e]})}(a);t["default"]=n.a},edb1:function(e,t,i){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var s=a(i("a34a")),n=i("2f62");function a(e){return e&&e.__esModule?e:{default:e}}function o(e,t,i,s,n,a,o){try{var c=e[a](o),r=c.value}catch(u){return void i(u)}c.done?t(r):Promise.resolve(r).then(s,n)}function c(e){return function(){var t=this,i=arguments;return new Promise(function(s,n){var a=e.apply(t,i);function c(e){o(a,s,n,c,r,"next",e)}function r(e){o(a,s,n,c,r,"throw",e)}c(void 0)})}}var r=function(){return i.e("components/Share/Share").then(i.bind(null,"bfd5"))},u=(0,n.createNamespacedHelpers)("storeCommodity"),d=(u.mapState,u.mapActions,{data:function(){return{specClass:"none",specSelected:{},favorite:!0,shareList:[],imgList:[],selected:"请选择规格: ",popup:{logoImg:"",name:"",salesPrice:"",specChildList:[],haveChosen:"",marketPrice:""},commodityInfo:{title:"",first:"",disacount:"",third:"",supplyType:""},desc:"",isPopup:"specs",purchaseQuantity:1,isGoods:!1,isGoodsTxt:"确定",forElection:[],commentListItem:null,isImmediately:""}},components:{Share:r},onLoad:function(){var t=c(s.default.mark(function t(i){var n=this;return s.default.wrap(function(t){while(1)switch(t.prev=t.next){case 0:this.goodsId=i.id,this.$request.GET({url:this.$api.apiUrl.GET_GOODS_INFO,data:{id:i.id}}).then(function(e){if(200===e.code){var t=e.data;n.imgList=t.slider_img.map(function(e,t){return{src:e}}),n.commodityInfo={title:t.title,first:t.price.first,disacount:t.price.disacount,third:t.price.third,supplyType:t.supply_type},n.specSelected=t.goods_spec,n.popup={logoImg:t.logo_img,spec:t.spec,marketPrice:t.price.first,purchasePrice:t.price.third,salesPrice:t.price.second,specChildList:Object.keys(t.goods_spec).map(function(e,i){return{id:i,names:e,name:t.goods_spec[e].map(function(e){return{name:e,selected:!1}}),allName:e,itemId:t.id}}),haveChosen:""},n.desc='<div style="width:100%">'.concat(t.content.replace(/<img/g,"<img class='imgWidth'"),"</div>")}else n.$api.msg(e.msg)}),this.$request.GET({url:this.$api.apiUrl.GET_GOODS_COMMENT,data:{id:i.id,page:1}}).then(function(e){e.data.length&&(n.commentListItem=e.data[0])}),e.showShareMenu({withShareTicket:!0});case 4:case"end":return t.stop()}},t,this)}));function i(e){return t.apply(this,arguments)}return i}(),methods:{toggleSpec:function(e){var t=this;this.isPopup=e,"show"===this.specClass?(this.specClass="hide",setTimeout(function(){t.specClass="none"},250)):"none"===this.specClass&&(this.specClass="show")},toggleSpecSpecial:function(){if("请选择规格: "===this.selected)return this.$api.msg("请选择规格"),!1;this.findIsSelected().length!=this.popup.specChildList.length?this.$api.msg("请选择"+this.forElection[0]):(this.toggleSpec(),this.addCart(this.isImmediately?"immediately":""))},selectSpec:function(e,t,i,s){var n=this;this.selected="已选: ";var a=this.popup.specChildList;a.forEach(function(e,s){e.name.forEach(function(e,a){e===i?n.$set(n.popup.specChildList[s].name[a],"selected",!0):s===t&&n.$set(n.popup.specChildList[s].name[a],"selected",!1)})});var o=this.findIsSelected();this.popup.haveChosen=o.join(",");var c=o.map(function(e){return e.split(":")[0]}),r=a.map(function(e){return e.allName});function u(e,t){var i=[],s=[];return i=e.filter(function(e){return-1==t.indexOf(e)}),s=t.filter(function(t){return-1==e.indexOf(t)}),i.concat(s)}var d=u(c,r);if(this.forElection=d,d.length)for(var p=0;p<d.length;p++){var l=d[p];this.$set(this.popup,"haveChosen",this.popup.haveChosen+" 请选择: "+l)}this.findIsSelected().length===a.length&&this.$request.POST({url:this.$api.apiUrl.POST_GOODS_STOCK,data:{id:e.itemId,spec:this.findIsSelected().join(",")}}).then(function(e){200===e.code?(n.$set(n.popup,"marketPrice",e.data.market_price),n.$set(n.popup,"purchasePrice",e.data.purchase_price),n.$set(n.popup,"salesPrice",e.data.sales_price),-1===e.code||e.data.stock<=0?(n.isGoods=!0,n.isGoodsTxt="暂无库存"):(n.isGoods=!1,n.isGoodsTxt="确定")):(n.isGoods=!0,n.isGoodsTxt=e.msg)})},share:function(){this.$refs.share.toggleMask()},toFavorite:function(){this.favorite=!this.favorite},buy:function(){},stopPrevent:function(){},forward:function(){this.$api.msg("可通过右上角进行分享")},changeQuantity:function(e){"+"===e?this.purchaseQuantity++:this.purchaseQuantity>1&&this.purchaseQuantity--},detectionValue:function(e){var t=e.detail.value;if(""===t)return this.purchaseQuantity=1,1;var i=/^\+?[1-9][0-9]*$/;return i.test(t)?(this.purchaseQuantity=t,t):(this.purchaseQuantity=1,1)},addCart:function(t){var i=this;this.isImmediately="immediately"===t?"/true":"","请选择规格: "===this.selected?this.toggleSpec("specs"):(this.navToLogin(),this.$request.GET({url:this.$api.apiUrl.GET_USER_AUTH_STATUS}).then(function(t){if(200===t.code){var s=i.popup.spec.find(function(e){return e.name===i.findIsSelected().join(",")});i.$request.POST({url:i.$api.apiUrl.POST_SAVE_CART+i.isImmediately,data:{goods_id:i.goodsId,spec_id:s.id,goods_num:i.purchaseQuantity,is_page:"product"}}).then(function(t){i.$api.msg(t.msg),i.isImmediately&&e.showLoading({title:"正在跳转到订单页面",success:function(){e.navigateTo({url:"/pages/carts/buy/buy",success:function(){e.hideLoading()}})}})})}else i.$api.msg("请登录,并认证")}))},findIsSelected:function(){for(var e=this.popup.specChildList,t=[],i=0;i<e.length;i++)for(var s=e[i].name,n=0;n<s.length;n++){var a=s[n];a.selected&&t.push(e[i].allName+":"+a.name)}return t},navToLogin:function(){var t=e.getStorageSync("access_token");t||e.navigateTo({url:"/pages/mys/login/login"})},toEvaluatePage:function(){e.navigateTo({url:"/pages/goodss/evaluate/evaluate?id=".concat(this.goodsId)})}}});t.default=d}).call(this,i("543d")["default"])},ef58:function(e,t,i){"use strict";i.r(t);var s=i("f441"),n=i("d102");for(var a in n)"default"!==a&&function(e){i.d(t,e,function(){return n[e]})}(a);i("1540");var o=i("2877"),c=Object(o["a"])(n["default"],s["a"],s["b"],!1,null,null,null);t["default"]=c.exports},f441:function(e,t,i){"use strict";var s=function(){var e=this,t=e.$createElement;e._self._c},n=[];i.d(t,"a",function(){return s}),i.d(t,"b",function(){return n})}},[["059c","common/runtime","common/vendor"]]]);